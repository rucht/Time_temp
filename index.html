<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Fortunately & YÄ±lÄ±n MalÄ± 2025</title>

<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  
  :root {
    --bg-gradient: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%);
    --card-bg: rgba(255, 255, 255, 0.15);
    --text-color: #fff;
    --currency-num-color: #003366; 
    --card-border: rgba(255, 255, 255, 0.3);
    --food-btn-bg: #ffeb3b;
    --food-btn-text: #333;
    
    /* --- CHRISTMAS THEME COLORS --- */
    --xmas-red: #d42426;
    --xmas-green: #2f5a2e;
    --xmas-gold: #f8b229;
    --xmas-light: #fdf6e3;
  }

  body {
    font-family: "Poppins", sans-serif;
    background: var(--bg-gradient);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
    color: var(--text-color);
    transition: background 0.5s ease;
  }

  /* --- DARK MODE STYLES --- */
  body.dark-mode {
    --bg-gradient: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    --card-bg: rgba(0, 0, 0, 0.5);
    --text-color: #e0e0e0;
    --currency-num-color: #4db8ff; 
    --card-border: rgba(255, 255, 255, 0.1);
    --food-btn-bg: #4db8ff;
    --food-btn-text: #000;
  }

  /* --- GLOBAL CHRISTMAS MODE STYLES (NEW) --- */
  body.xmas-mode {
    /* KÄ±rmÄ±zÄ±/YeÅŸil KarlÄ± Arka Plan */
    background: linear-gradient(135deg, rgba(212, 36, 38, 0.9) 0%, rgba(47, 90, 46, 0.9) 100%), url('https://www.transparenttextures.com/patterns/snow.png') !important;
    --card-border: var(--xmas-gold);
    --currency-num-color: var(--xmas-gold);
  }
  body.xmas-mode h1 {
      text-shadow: 2px 2px 4px var(--xmas-red), 0 0 10px var(--xmas-gold);
  }
  /* Xmas modunda ÅŸehir ve kur kartlarÄ±nÄ±n kenarlarÄ±nÄ± altÄ±n yap */
  body.xmas-mode .city, 
  body.xmas-mode #currency-ticker {
      border-color: var(--xmas-gold);
      box-shadow: 0 5px 15px rgba(248, 178, 41, 0.3);
  }


  /* --- TOGGLE BUTTONS --- */
  .theme-toggle {
    position: absolute;
    right: 20px;
    background: rgba(255, 255, 255, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.4);
    color: #fff;
    font-size: 1.5rem;
    width: 45px;
    height: 45px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s;
    z-index: 100;
  }
  .theme-toggle:hover { background: rgba(255, 255, 255, 0.4); transform: scale(1.1); }
  
  #theme-toggle { top: 20px; }
  /* Yeni YÄ±lbaÅŸÄ± Butonu */
  #xmas-toggle { top: 75px; background: rgba(212, 36, 38, 0.5); border-color: var(--xmas-gold); }
  #xmas-toggle:hover { background: var(--xmas-green); }


  /* --- CURRENCY TICKER --- */
  #currency-ticker {
    width: 100%;
    max-width: 1100px;
    background: var(--card-bg);
    backdrop-filter: blur(10px);
    border: 1px solid var(--card-border);
    border-radius: 15px;
    padding: 10px 20px;
    margin-bottom: 30px;
    margin-top: 80px; /* Butonlar iÃ§in biraz daha yer aÃ§tÄ±k */
    display: flex;
    justify-content: center;
    gap: 30px;
    font-weight: 600;
    font-size: 1.1rem;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    transition: background 0.3s;
  }
  .currency-item span { 
    color: var(--currency-num-color); 
    margin-left: 5px; 
    font-weight: 700;
  }

  h1 { font-size: 2rem; margin-bottom: 25px; text-shadow: 0 2px 6px rgba(0,0,0,0.3); text-align: center; }
  
  /* --- CITIES GRID --- */
  #cities {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(270px, 1fr));
    gap: 25px;
    width: 100%;
    max-width: 1100px;
    margin-bottom: 50px;
  }
  .city {
    position: relative;
    border-radius: 20px;
    overflow: hidden;
    background: var(--card-bg);
    backdrop-filter: blur(10px);
    border: 1px solid var(--card-border);
    transition: transform 0.3s, background 0.3s;
    display: flex;
    flex-direction: column;
  }
  .city img { width: 100%; height: 180px; object-fit: cover; background: #ddd; }
  .city-info { padding: 20px; text-align: center; background: rgba(0,0,0,0.1); flex-grow: 1; }
  .city h3 { margin-bottom: 6px; }
  .city .condition { font-size: 0.9rem; margin-top: 4px; font-weight: 500; opacity: 0.9; }
  
  /* --- PHOTO ACTIONS --- */
  .actions {
    margin-top: 15px;
    display: flex;
    justify-content: center;
    gap: 15px;
  }
  .action-btn {
    background: rgba(255,255,255,0.2);
    border: 1px solid rgba(255,255,255,0.4);
    color: var(--text-color);
    width: 36px;
    height: 36px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s;
    font-size: 1.1rem;
  }
  .action-btn:hover { background: rgba(255,255,255,0.4); }
  .file-input { display: none; }

  /* --- GAME SECTION STYLES (CHRISTMAS EDITION) --- */
  #game-section {
    width: 100%;
    max-width: 900px;
    /* YÄ±lbaÅŸÄ± arka planÄ± */
    background: linear-gradient(135deg, rgba(212, 36, 38, 0.15) 0%, rgba(47, 90, 46, 0.15) 100%), url('https://www.transparenttextures.com/patterns/snow.png');
    backdrop-filter: blur(12px);
    border: 3px solid var(--xmas-gold);
    border-radius: 25px;
    padding: 30px;
    margin-bottom: 50px;
    text-align: center;
    position: relative;
    box-shadow: 0 10px 30px rgba(212, 36, 38, 0.3), inset 0 0 20px rgba(248, 178, 41, 0.2);
    overflow: hidden;
  }

  #game-section::before {
    content: 'ğŸ„ğŸ…ğŸ„â˜ƒï¸ğŸ„ğŸğŸ„ğŸ…ğŸ„â„ï¸ğŸ„ğŸ¦ŒğŸ„';
    display: block;
    text-align: center;
    font-size: 1.5rem;
    margin-bottom: 15px;
    letter-spacing: 3px;
    opacity: 0.9;
    text-shadow: 0 2px 5px rgba(0,0,0,0.2);
  }

  .game-header h2 {
    font-size: 2rem;
    margin-bottom: 10px;
    background: repeating-linear-gradient(45deg, var(--text-color), var(--text-color) 10px, var(--xmas-red) 10px, var(--xmas-red) 20px);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    font-weight: 800;
  }
  
  .game-subtitle {
    font-size: 1rem;
    opacity: 0.9;
    margin-bottom: 30px;
    font-weight: 500;
  }

  .battle-arena {
    display: flex;
    flex-direction: row;
    align-items: stretch;
    justify-content: center;
    gap: 20px;
    flex-wrap: wrap;
  }

  .choice-card {
    flex: 1;
    min-width: 280px;
    min-height: 220px;
    background: rgba(255,255,255,0.1);
    border: 3px dashed rgba(255, 255, 255, 0.5);
    border-radius: 15px;
    padding: 25px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.15rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    position: relative;
    overflow: hidden;
  }

  #card-a::after { content: 'ğŸ'; position: absolute; bottom: 10px; right: 10px; font-size: 1.5rem; opacity: 0.6; }
  #card-b::after { content: 'ğŸ§¦'; position: absolute; bottom: 10px; right: 10px; font-size: 1.5rem; opacity: 0.6; }

  .choice-card:hover {
    transform: translateY(-5px);
    background: rgba(255,255,255,0.2);
    border-style: solid;
    box-shadow: 0 0 20px var(--xmas-gold), inset 0 0 10px var(--xmas-red);
  }

  .choice-card:active {
    transform: scale(0.98);
  }

  .vs-badge {
    background: radial-gradient(circle at 30% 30%, #ff7678, var(--xmas-red));
    color: var(--xmas-gold);
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 1.3rem;
    border: 3px solid var(--xmas-gold);
    z-index: 2;
    box-shadow: 0 0 15px var(--xmas-red), inset 0 0 5px rgba(255,255,255,0.5);
    align-self: center;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.4);
  }

  /* Winner Animation Styles */
  #winner-display {
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    animation: fadeIn 1s ease;
    padding: 20px;
  }

  .winner-gif {
      width: 180px; /* GIF BOYUTU KÃœÃ‡ÃœLTÃœLDÃœ (250 -> 180) */
      height: auto;
      border-radius: 15px;
      border: 4px solid var(--xmas-gold);
      box-shadow: 0 0 25px var(--xmas-gold), 0 0 10px var(--xmas-red);
      margin-bottom: 15px;
  }

  .winner-title { font-size: 1.5rem; font-weight: bold; color: var(--xmas-gold); text-shadow: 0 0 10px rgba(248, 178, 41, 0.5); margin-bottom: 10px; }
  
  .winner-culprit { 
      font-size: 2.2rem; 
      font-weight: 800; 
      margin-bottom: 15px; 
      letter-spacing: 1px;
      color: var(--xmas-red);
      background: url('https://www.transparenttextures.com/patterns/snow.png'), rgba(255,255,255,0.9);
      padding: 5px 25px;
      border-radius: 15px;
      border: 3px dashed var(--xmas-green);
      text-shadow: 2px 2px 0px var(--xmas-gold);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
  }

  /* YENÄ°: KAZANAN FOTOÄRAFI STÄ°LÄ° */
  .winner-photo {
      width: 120px;
      height: 120px;
      object-fit: cover;
      border-radius: 50%;
      border: 4px solid var(--xmas-gold);
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      margin-bottom: 20px;
  }
  
  .winner-text { font-size: 1.2rem; font-style: italic; opacity: 0.9; max-width: 600px; margin-bottom: 25px; font-weight: 500; }
  
  .restart-btn {
    padding: 12px 30px;
    background: var(--xmas-red);
    color: var(--xmas-light);
    border: 2px solid var(--xmas-gold);
    border-radius: 25px;
    font-weight: bold;
    font-size: 1.1rem;
    cursor: pointer;
    margin-top: 15px;
    transition: all 0.2s;
    box-shadow: 0 5px 15px rgba(212, 36, 38, 0.4);
  }
  .restart-btn:hover { 
      transform: scale(1.05); 
      background: var(--xmas-green);
      box-shadow: 0 0 20px var(--xmas-green); 
  }

  @keyframes fadeIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }


  /* --- FOOD SECTION STYLES --- */
  #food-section {
    width: 100%;
    max-width: 1100px;
    margin-top: 20px;
    margin-bottom: 50px;
  }
  .section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--card-border);
    transition: border-color 0.5s ease;
  }
  body.xmas-mode .section-header { border-color: var(--xmas-gold); }

  .upload-food-btn {
    background: var(--food-btn-bg);
    color: var(--food-btn-text);
    border: none;
    padding: 8px 16px;
    border-radius: 20px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    transition: transform 0.2s;
  }
  .upload-food-btn:hover { transform: scale(1.05); }

  #food-gallery {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 15px;
  }
  .food-item {
    position: relative;
    border-radius: 15px;
    overflow: hidden;
    height: 150px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    background: rgba(0,0,0,0.1);
  }
  .food-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s;
  }
  .food-item:hover img { transform: scale(1.1); }
  
  .delete-food {
    position: absolute;
    top: 5px;
    right: 5px;
    background: rgba(255,0,0,0.7);
    color: white;
    border: none;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8rem;
    opacity: 0;
    transition: opacity 0.2s;
  }
  .food-item:hover .delete-food { opacity: 1; }

</style>
</head>
<body>

<button id="theme-toggle" class="theme-toggle" title="Toggle Dark Mode">ğŸŒ™</button>
<button id="xmas-toggle" class="theme-toggle" title="Toggle Christmas Mode">ğŸ…</button>


<div id="currency-ticker">
    <div class="currency-item" id="eur-usd">â‚¬1 = <span>...</span> USD</div>
    <div class="currency-item" id="eur-try">â‚¬1 = <span>...</span> TL</div>
</div>

<h1>ğŸŒ Fortunately</h1>

<div id="cities"></div>

<div id="game-section">
    <div class="game-header">
        <h2>ğŸ… YÄ±lÄ±n MalÄ± 2025 SeÃ§meleri ğŸ„</h2>
        <p class="game-subtitle" id="game-status">Hangi mallÄ±k daha bÃ¼yÃ¼k? SeÃ§imini yap, kazananÄ± bul!</p>
    </div>

    <div class="battle-arena" id="battle-arena">
        <div class="choice-card" id="card-a">
            <span class="card-text">SeÃ§enek A</span>
        </div>
        
        <div class="vs-badge">VS</div>
        
        <div class="choice-card" id="card-b">
            <span class="card-text">SeÃ§enek B</span>
        </div>
    </div>

    <div id="winner-display">
        <img src="https://i.hizliresim.com/q8mg9dn.gif" alt="Contravolta" class="winner-gif">
        <div class="winner-title">ğŸ‰ YILIN EN BÃœYÃœK MALI 2025 ğŸ‰</div>
        <div class="winner-culprit" id="winner-name">Ä°SÄ°M</div>
        <img id="winner-photo" class="winner-photo" alt="Winner Photo" src="">
        <div class="winner-text" id="winner-desc">AÃ§Ä±klama</div>
        <button class="restart-btn" id="restart-game">ğŸ„ Tekrar Oyna ğŸ…</button>
    </div>
</div>
<div id="food-section">
    <div class="section-header">
        <h2>ğŸ“¸ Local Tastes</h2>
        <label class="upload-food-btn">
            ğŸ“· Upload Food
            <input type="file" id="food-input" class="file-input" accept="image/*">
        </label>
    </div>
    <div id="food-gallery">
        <p style="grid-column: 1/-1; text-align: center; opacity: 0.7;">No food photos yet. Upload one!</p>
    </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getDatabase, ref, onValue, set, push, remove } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCUTBQ5oIgF1GEU8rGj9Mxqz7a2g1Ecswk",
    authDomain: "timetemp-9b1a5.firebaseapp.com",
    databaseURL: "https://timetemp-9b1a5-default-rtdb.firebaseio.com/",
    projectId: "timetemp-9b1a5",
    storageBucket: "timetemp-9b1a5.firebasestorage.app",
    messagingSenderId: "580366684921",
    appId: "1:580366684921:web:2133261bcfccc0a21a0828",
    measurementId: "G-THB6G2TWEV"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // --- Dark Mode Logic ---
  const toggleBtn = document.getElementById("theme-toggle");
  
  if (localStorage.getItem("theme") === "dark") {
    document.body.classList.add("dark-mode");
    toggleBtn.textContent = "â˜€ï¸";
  }

  toggleBtn.addEventListener("click", () => {
    document.body.classList.toggle("dark-mode");
    const isDark = document.body.classList.contains("dark-mode");
    toggleBtn.textContent = isDark ? "â˜€ï¸" : "ğŸŒ™";
    localStorage.setItem("theme", isDark ? "dark" : "light");
  });

  // --- YENÄ°: GLOBAL XMAS MODE LOGIC ---
  const xmasToggleBtn = document.getElementById("xmas-toggle");

  // Check local storage for xmas preference
  if (localStorage.getItem("xmasTheme") === "true") {
      document.body.classList.add("xmas-mode");
  }

  xmasToggleBtn.addEventListener("click", () => {
      document.body.classList.toggle("xmas-mode");
      localStorage.setItem("xmasTheme", document.body.classList.contains("xmas-mode"));
  });


  const cities = [
    { name: "Istanbul", timezone: "Europe/Istanbul", lat: 41.0082, lon: 28.9784, img: "https://images.unsplash.com/photo-1524231757912-21f4fe3a7200?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" },
    { name: "Ankara", timezone: "Europe/Istanbul", lat: 39.9334, lon: 32.8597, img: "https://pbs.twimg.com/media/G3ALijdXcAA4cI4?format=jpg&name=900x900" },
    { name: "Munich", timezone: "Europe/Berlin", lat: 48.1351, lon: 11.5820, img: "https://tallgirlbigworld.com/wp-content/uploads/2021/10/Marienplatz-Munich.jpg" },
    { name: "Boston", timezone: "America/New_York", lat: 42.3601, lon: -71.0589, img: "https://www.travelandleisure.com/thmb/OxTfa-TTiGTLm_jUvSw2egK7eSs=/750x0/filters:no_upscale():max_bytes(150000):strip_icc():format(webp)/boston-massachusetts-BOSTONTG0221-719aef2eeb1c4929b6c839715e34a69e.jpg" },
    { name: "Leipzig", timezone: "Europe/Berlin", lat: 51.3397, lon: 12.3731, img: "https://img.ecmaps.de/remote/.webp?url=https%3A%2F%2Fdam.destination.one%2F2514134%2Fe9e1b4e85a01247d6242aa96e7a67f36d1db43aacb3a2b004410b3e8bfd920cb%2Fyour-meeting-conference-in-leipzig-augustusplatz-with-opera-gewandhaus-city-hochhaus.jpg&scale=both&mode=crop&quality=90&width=751&height=563" },
    { name: "Tucson", timezone: "America/Phoenix", lat: 32.2226, lon: -110.9747, img: "https://wnpa.org/sites/default/files/styles/scale_1920/public/2025-04/qUmhXeM1COMBFlSa.webp?itok=sFd5Ijpq" },
    { name: "San Diego", timezone: "America/Los_Angeles", lat: 32.7157, lon: -117.1611, img: "https://specials-images.forbesimg.com/dam/imageserve/1120536785/960x0.jpg?fit=scale" }
  ];

  const weatherDescriptions = {
    0: "â˜€ï¸ Clear", 1: "ğŸŒ¤ Mainly clear", 2: "â›… Partly cloudy", 3: "â˜ï¸ Overcast",
    45: "ğŸŒ« Fog", 48: "ğŸŒ« Rime fog", 51: "ğŸŒ¦ Drizzle", 53: "ğŸŒ¦ Mod. drizzle", 55: "ğŸŒ§ Dense drizzle",
    61: "ğŸŒ¦ Slight rain", 63: "ğŸŒ§ Mod. rain", 65: "ğŸŒ§ Heavy rain", 71: "ğŸŒ¨ Slight snow",
    73: "ğŸŒ¨ Mod. snow", 75: "â„ï¸ Heavy snow", 77: "ğŸŒ¨ Snow grains", 80: "ğŸŒ§ Showers",
    81: "ğŸŒ§ Heavy showers", 82: "ğŸŒ§ Violent showers", 95: "â›ˆ Thunderstorm",
    96: "â›ˆ Hail Storm", 99: "ğŸŒ© Severe Storm"
  };

  const container = document.getElementById("cities");
  const foodGallery = document.getElementById("food-gallery");

  // --- Currency Logic (Base EUR) ---
  async function updateCurrency() {
    try {
        const res = await fetch("https://api.frankfurter.app/latest?from=EUR&to=USD,TRY");
        const data = await res.json();
        document.querySelector("#eur-usd span").textContent = data.rates.USD.toFixed(2);
        document.querySelector("#eur-try span").textContent = data.rates.TRY.toFixed(2);
    } catch (e) {
        console.error("Currency Error", e);
    }
  }

  // --- Image Compression ---
  function resizeImage(file, callback) {
    const reader = new FileReader();
    reader.onload = function(event) {
        const img = new Image();
        img.onload = function() {
            const canvas = document.createElement("canvas");
            const ctx = canvas.getContext("2d");
            const maxWidth = 800; 
            let width = img.width;
            let height = img.height;

            if (width > maxWidth) {
                height = height * (maxWidth / width);
                width = maxWidth;
            }

            canvas.width = width;
            canvas.height = height;
            ctx.drawImage(img, 0, 0, width, height);
            const dataUrl = canvas.toDataURL("image/jpeg", 0.7); 
            callback(dataUrl);
        };
        img.src = event.target.result;
    };
    reader.readAsDataURL(file);
  }

  // --- City UI ---
  cities.forEach(city => {
    const div = document.createElement("div");
    div.className = "city";
    div.innerHTML = `
      <img src="${city.img}" alt="${city.name}"> 
      <div class="city-info">
        <h3>${city.name}</h3>
        <p class="time">--:--</p>
        <p class="temp">-- Â°C</p>
        <p class="condition">--</p> 
        <div class="actions">
            <label class="action-btn" title="Upload Photo">
                ğŸ“· <input type="file" class="file-input" accept="image/*">
        </div>
      </div>
    `;
    container.appendChild(div);
    city.element = div;

    div.querySelector(".file-input").addEventListener("change", (e) => {
        if (e.target.files[0]) {
            resizeImage(e.target.files[0], (dataUrl) => {
                set(ref(db, "cities/" + city.name + "/img"), dataUrl);
            });
        }
    });

    onValue(ref(db, "cities/" + city.name + "/img"), snap => {
      if(snap.val()) div.querySelector("img").src = snap.val();
    });
  });

  // --- Food Section ---
  document.getElementById("food-input").addEventListener("change", (e) => {
    if (e.target.files[0]) {
        resizeImage(e.target.files[0], (dataUrl) => {
            push(ref(db, "foods"), { url: dataUrl, timestamp: Date.now() });
        });
    }
  });

  onValue(ref(db, "foods"), snap => {
    foodGallery.innerHTML = "";
    const data = snap.val();
    
    if (!data) {
        foodGallery.innerHTML = '<p style="grid-column: 1/-1; text-align: center; opacity: 0.7;">No food photos yet. Upload one!</p>';
        return;
    }

    Object.keys(data).forEach(key => {
        const item = data[key];
        const div = document.createElement("div");
        div.className = "food-item";
        div.innerHTML = `
            <img src="${item.url}" loading="lazy">
            <button class="delete-food" title="Delete">ğŸ—‘ï¸</button>
        `;
        div.querySelector(".delete-food").addEventListener("click", () => {
            if(confirm("Delete this food photo?")) remove(ref(db, "foods/" + key));
        });
        foodGallery.insertBefore(div, foodGallery.firstChild);
    });
  });

  // --- GAME LOGIC (YILIN MALI) ---
  const mallikData = [
    { text: "Berkay'Ä±n 1 ocakta yeni yÄ±la girdiÄŸi iÃ§in sevinmesi", culprit: "Berkay" },
    { text: "Berkay'Ä±n tuvalette Ã§Ä±plak 20dkdÄ±r grupla mesajlaÅŸmaktan duÅŸa girememesi", culprit: "Berkay" },
    { text: "Ã–zgÃ¼r'Ã¼n sim kartÄ± amerikada unutup TÃ¼rkiye'de yeni sim kart alÄ±p onu da kullanmadan e-sim ile takÄ±lmasÄ±", culprit: "Ã–zgÃ¼r" },
    { text: "Kutalp'in yanlÄ±ÅŸlÄ±kla kÃ¼Ã§Ã¼k boy nevresim almasÄ±", culprit: "Kutalp" },
    { text: "Kerim'in en Ã¶nemli vize belgesini 4e katlayÄ±p rafÄ±n altÄ±na atÄ±p 4 ay dokunmamasÄ±", culprit: "Kerim" },
    { text: "Berkay'Ä±n At-11 belgesi almadan Almanya'ya gelip Almanya'da 5-6 ayrÄ± sefer saÄŸlÄ±k sigortasÄ± kurumuna gitmek durumunda kalmasÄ±, TÃ¼rkiye'deki SGK'ya sahte montaj belge gÃ¶nderip onun da fark edilmesi Ã¼zerine hala saÄŸlÄ±k sigortasÄ±nÄ±n olmamasÄ±", culprit: "Berkay" },
    { text: "Berkay'Ä±n BÃ¼med yeni mekan aÃ§Ä±lÄ±ÅŸÄ±na gidip BoÄŸaz*ci ceketi giymesi", culprit: "Berkay" },
    { text: "Berkay'Ä±n TUM'da quiz iÃ§in sabahlayÄ±p 1-2 dakika geÃ§ kalarak geldikten sonra quize girip devamÄ±nda eve gitmek yerine derste 1.5 saat salya akÄ±tarak uyumasÄ±", culprit: "Berkay" },
    { text: "Kutalp'in De Marke haberin TÃ¼rkiyeâ€™nin dÃ¼nya kupasÄ±nda Avustralyaâ€™yla olan maÃ§Ä± Vancouverdeâ€™de oynanmasÄ± Ã¼zerine yaptÄ±ÄŸÄ± ÅŸaka", culprit: "Kutalp" },
    { text: "Berkay'Ä±n manitayla hapÃ§Ä± otÃ§u piyasacÄ± mekanÄ± olan Noh Radio Ã¶nÃ¼ne gitmesi", culprit: "Berkay" }
  ];

  // YENÄ°: KiÅŸilerin FotoÄŸraflarÄ± (DoÄŸrudan linkler)
  const culpritPhotos = {
      "Berkay": "https://i.postimg.cc/cL8Nz2Ln/1000084947.jpg",
      "Kutalp": "https://i.postimg.cc/PqYTC9GP/1000084613.jpg",
      "Kerim": "https://i.postimg.cc/Y9NrsV83/1000084596.jpg",
      "Ã–zgÃ¼r": "https://i.postimg.cc/5tYjnnZ7/IMG-8193.jpg"
  };

  let gameQueue = [];
  let currentChampion = null;
  let currentChallenger = null;

  const cardA = document.getElementById("card-a");
  const cardB = document.getElementById("card-b");
  const battleArena = document.getElementById("battle-arena");
  const winnerDisplay = document.getElementById("winner-display");
  const gameStatus = document.getElementById("game-status");
  const winnerName = document.getElementById("winner-name");
  const winnerDesc = document.getElementById("winner-desc");
  const winnerPhoto = document.getElementById("winner-photo"); // YENÄ°
  const restartBtn = document.getElementById("restart-game");

  // Shuffle Array (Fisher-Yates)
  function shuffle(array) {
    let currentIndex = array.length, randomIndex;
    while (currentIndex != 0) {
      randomIndex = Math.floor(Math.random() * currentIndex);
      currentIndex--;
      [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
    }
    return array;
  }

  function initGame() {
    // Reset view
    battleArena.style.display = "flex";
    winnerDisplay.style.display = "none";
    gameStatus.textContent = "Hangi mallÄ±k daha bÃ¼yÃ¼k? SeÃ§imini yap!";
    gameStatus.style.display = "block";

    // Setup Queue
    gameQueue = shuffle([...mallikData]);
    
    // Pick first two
    currentChampion = gameQueue.pop();
    currentChallenger = gameQueue.pop();
    
    renderRound();
  }

  function renderRound() {
    // Card A is always the current "King of the Hill" (Champion)
    cardA.querySelector(".card-text").textContent = currentChampion.text;
    
    // Card B is the Challenger
    cardB.querySelector(".card-text").textContent = currentChallenger.text;

    // Optional: Add visual count
    gameStatus.textContent = `Kalan Rakip: ${gameQueue.length} | Hangisi Daha Mal? ğŸ…`;
  }

  function handleSelection(winnerSide) {
    // If 'A' wins, currentChampion stays, Challenger is discarded.
    // If 'B' wins, currentChallenger becomes the new Champion.
    
    if (winnerSide === 'B') {
        currentChampion = currentChallenger;
    }
    // If winnerSide === 'A', currentChampion remains the same.

    // Check if queue has more challengers
    if (gameQueue.length > 0) {
        currentChallenger = gameQueue.pop();
        
        // Small animation effect
        battleArena.style.opacity = "0";
        setTimeout(() => {
            renderRound();
            battleArena.style.opacity = "1";
        }, 200);
    } else {
        endGame();
    }
  }

  function endGame() {
    battleArena.style.display = "none";
    gameStatus.style.display = "none";
    winnerDisplay.style.display = "flex";
    
    winnerName.textContent = currentChampion.culprit.toUpperCase();
    // YENÄ°: KazananÄ±n fotoÄŸrafÄ±nÄ± ayarla
    const photoUrl = culpritPhotos[currentChampion.culprit] || ""; // FotoÄŸraf yoksa boÅŸ bÄ±rak
    winnerPhoto.src = photoUrl;

    winnerDesc.textContent = `"${currentChampion.text}"`;
  }

  // Event Listeners for Game
  cardA.addEventListener("click", () => handleSelection('A'));
  cardB.addEventListener("click", () => handleSelection('B'));
  restartBtn.addEventListener("click", initGame);

  // Start the game on load
  initGame();


  // --- Time & Weather ---
  function updateTime() {
    const now = new Date();
    cities.forEach(city => {
      const timeStr = now.toLocaleTimeString("en-GB", { timeZone: city.timezone, hour: "2-digit", minute: "2-digit" });
      city.element.querySelector(".time").textContent = timeStr;
    });
  }

  async function updateWeather() {
    for (const city of cities) {
      try {
        const url = `https://api.open-meteo.com/v1/forecast?latitude=${city.lat}&longitude=${city.lon}&current_weather=true`;
        const res = await fetch(url);
        const data = await res.json();
        const code = data.current_weather.weathercode;
        city.element.querySelector(".temp").textContent = `${data.current_weather.temperature} Â°C`;
        city.element.querySelector(".condition").textContent = weatherDescriptions[code] || "Unknown";
      } catch {
        city.element.querySelector(".temp").textContent = "N/A";
      }
    }
  }

  updateTime(); setInterval(updateTime, 1000);
  updateWeather(); setInterval(updateWeather, 10 * 60 * 1000);
  updateCurrency(); setInterval(updateCurrency, 60 * 60 * 1000);

</script>
</body>
</html>
