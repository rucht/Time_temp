<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Fortunately Time & Weather</title>

<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  
  :root {
    --bg-gradient: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%);
    --card-bg: rgba(255, 255, 255, 0.15);
    --text-color: #fff;
    --currency-num-color: #003366; /* Dark Blue for visibility */
    --card-border: rgba(255, 255, 255, 0.3);
    --food-btn-bg: #ffeb3b;
    --food-btn-text: #333;
  }

  body {
    font-family: "Poppins", sans-serif;
    background: var(--bg-gradient);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
    color: var(--text-color);
    transition: background 0.5s ease;
  }

  /* --- DARK MODE STYLES --- */
  body.dark-mode {
    --bg-gradient: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    --card-bg: rgba(0, 0, 0, 0.5);
    --text-color: #e0e0e0;
    --currency-num-color: #4db8ff; /* Light Blue for Dark Mode */
    --card-border: rgba(255, 255, 255, 0.1);
    --food-btn-bg: #4db8ff;
    --food-btn-text: #000;
  }

  /* --- TOP RIGHT TOGGLE BUTTON --- */
  .theme-toggle {
    position: absolute;
    top: 20px;
    right: 20px;
    background: rgba(255, 255, 255, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.4);
    color: #fff;
    font-size: 1.5rem;
    width: 45px;
    height: 45px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s;
    z-index: 100;
  }
  .theme-toggle:hover { background: rgba(255, 255, 255, 0.4); transform: scale(1.1); }

  /* --- CURRENCY TICKER --- */
  #currency-ticker {
    width: 100%;
    max-width: 1100px;
    background: var(--card-bg);
    backdrop-filter: blur(10px);
    border: 1px solid var(--card-border);
    border-radius: 15px;
    padding: 10px 20px;
    margin-bottom: 30px;
    margin-top: 40px; /* Space for toggle button */
    display: flex;
    justify-content: center;
    gap: 30px;
    font-weight: 600;
    font-size: 1.1rem;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    transition: background 0.3s;
  }
  .currency-item span { 
    color: var(--currency-num-color); 
    margin-left: 5px; 
    font-weight: 700;
  }

  h1 { font-size: 2rem; margin-bottom: 25px; text-shadow: 0 2px 6px rgba(0,0,0,0.3); text-align: center; }
  
  /* --- CITIES GRID --- */
  #cities {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(270px, 1fr));
    gap: 25px;
    width: 100%;
    max-width: 1100px;
    margin-bottom: 50px;
  }
  .city {
    position: relative;
    border-radius: 20px;
    overflow: hidden;
    background: var(--card-bg);
    backdrop-filter: blur(10px);
    border: 1px solid var(--card-border);
    transition: transform 0.3s, background 0.3s;
    display: flex;
    flex-direction: column;
  }
  .city img { width: 100%; height: 180px; object-fit: cover; background: #ddd; }
  .city-info { padding: 20px; text-align: center; background: rgba(0,0,0,0.1); flex-grow: 1; }
  .city h3 { margin-bottom: 6px; }
  .city .condition { font-size: 0.9rem; margin-top: 4px; font-weight: 500; opacity: 0.9; }
  
  /* --- PHOTO ACTIONS --- */
  .actions {
    margin-top: 15px;
    display: flex;
    justify-content: center;
    gap: 15px;
  }
  .action-btn {
    background: rgba(255,255,255,0.2);
    border: 1px solid rgba(255,255,255,0.4);
    color: var(--text-color);
    width: 36px;
    height: 36px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s;
    font-size: 1.1rem;
  }
  .action-btn:hover { background: rgba(255,255,255,0.4); }
  .file-input { display: none; }

  /* --- FOOD SECTION STYLES --- */
  #food-section {
    width: 100%;
    max-width: 1100px;
    margin-top: 20px;
  }
  .section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--card-border);
  }
  .upload-food-btn {
    background: var(--food-btn-bg);
    color: var(--food-btn-text);
    border: none;
    padding: 8px 16px;
    border-radius: 20px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    transition: transform 0.2s;
  }
  .upload-food-btn:hover { transform: scale(1.05); }

  #food-gallery {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 15px;
  }
  .food-item {
    position: relative;
    border-radius: 15px;
    overflow: hidden;
    height: 150px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    background: rgba(0,0,0,0.1);
  }
  .food-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s;
  }
  .food-item:hover img { transform: scale(1.1); }
  
  .delete-food {
    position: absolute;
    top: 5px;
    right: 5px;
    background: rgba(255,0,0,0.7);
    color: white;
    border: none;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8rem;
    opacity: 0;
    transition: opacity 0.2s;
  }
  .food-item:hover .delete-food { opacity: 1; }

</style>
</head>
<body>

<button id="theme-toggle" class="theme-toggle" title="Toggle Dark Mode">üåô</button>

<div id="currency-ticker">
    <div class="currency-item" id="eur-usd">‚Ç¨1 = <span>...</span> USD</div>
    <div class="currency-item" id="eur-try">‚Ç¨1 = <span>...</span> TL</div>
</div>

<h1>üåç Fortunately' Time & Weather</h1>

<div id="cities"></div>

<div id="food-section">
    <div class="section-header">
        <h2>üì∏ Local Tastes</h2>
        <label class="upload-food-btn">
            üì∑ Upload Food
            <input type="file" id="food-input" class="file-input" accept="image/*">
        </label>
    </div>
    <div id="food-gallery">
        <p style="grid-column: 1/-1; text-align: center; opacity: 0.7;">No food photos yet. Upload one!</p>
    </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getDatabase, ref, onValue, set, push, remove } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCUTBQ5oIgF1GEU8rGj9Mxqz7a2g1Ecswk",
    authDomain: "timetemp-9b1a5.firebaseapp.com",
    databaseURL: "https://timetemp-9b1a5-default-rtdb.firebaseio.com/",
    projectId: "timetemp-9b1a5",
    storageBucket: "timetemp-9b1a5.firebasestorage.app",
    messagingSenderId: "580366684921",
    appId: "1:580366684921:web:2133261bcfccc0a21a0828",
    measurementId: "G-THB6G2TWEV"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // --- Dark Mode Logic ---
  const toggleBtn = document.getElementById("theme-toggle");
  
  // Check local storage for preference
  if (localStorage.getItem("theme") === "dark") {
    document.body.classList.add("dark-mode");
    toggleBtn.textContent = "‚òÄÔ∏è";
  }

  toggleBtn.addEventListener("click", () => {
    document.body.classList.toggle("dark-mode");
    const isDark = document.body.classList.contains("dark-mode");
    toggleBtn.textContent = isDark ? "‚òÄÔ∏è" : "üåô";
    localStorage.setItem("theme", isDark ? "dark" : "light");
  });

  const cities = [
    { name: "Istanbul", timezone: "Europe/Istanbul", lat: 41.0082, lon: 28.9784, img: "https://images.unsplash.com/photo-1524231757912-21f4fe3a7200?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" },
    { name: "Ankara", timezone: "Europe/Istanbul", lat: 39.9334, lon: 32.8597, img: "https://pbs.twimg.com/media/G3ALijdXcAA4cI4?format=jpg&name=900x900" },
    { name: "Munich", timezone: "Europe/Berlin", lat: 48.1351, lon: 11.5820, img: "https://tallgirlbigworld.com/wp-content/uploads/2021/10/Marienplatz-Munich.jpg" },
    { name: "Boston", timezone: "America/New_York", lat: 42.3601, lon: -71.0589, img: "https://www.travelandleisure.com/thmb/OxTfa-TTiGTLm_jUvSw2egK7eSs=/750x0/filters:no_upscale():max_bytes(150000):strip_icc():format(webp)/boston-massachusetts-BOSTONTG0221-719aef2eeb1c4929b6c839715e34a69e.jpg" },
    { name: "Leipzig", timezone: "Europe/Berlin", lat: 51.3397, lon: 12.3731, img: "https://img.ecmaps.de/remote/.webp?url=https%3A%2F%2Fdam.destination.one%2F2514134%2Fe9e1b4e85a01247d6242aa96e7a67f36d1db43aacb3a2b004410b3e8bfd920cb%2Fyour-meeting-conference-in-leipzig-augustusplatz-with-opera-gewandhaus-city-hochhaus.jpg&scale=both&mode=crop&quality=90&width=751&height=563" },
    { name: "Tucson", timezone: "America/Phoenix", lat: 32.2226, lon: -110.9747, img: "https://wnpa.org/sites/default/files/styles/scale_1920/public/2025-04/qUmhXeM1COMBFlSa.webp?itok=sFd5Ijpq" },
    { name: "San Diego", timezone: "America/Los_Angeles", lat: 32.7157, lon: -117.1611, img: "https://specials-images.forbesimg.com/dam/imageserve/1120536785/960x0.jpg?fit=scale" }
  ];

  const weatherDescriptions = {
    0: "‚òÄÔ∏è Clear", 1: "üå§ Mainly clear", 2: "‚õÖ Partly cloudy", 3: "‚òÅÔ∏è Overcast",
    45: "üå´ Fog", 48: "üå´ Rime fog", 51: "üå¶ Drizzle", 53: "üå¶ Mod. drizzle", 55: "üåß Dense drizzle",
    61: "üå¶ Slight rain", 63: "üåß Mod. rain", 65: "üåß Heavy rain", 71: "üå® Slight snow",
    73: "üå® Mod. snow", 75: "‚ùÑÔ∏è Heavy snow", 77: "üå® Snow grains", 80: "üåß Showers",
    81: "üåß Heavy showers", 82: "üåß Violent showers", 95: "‚õà Thunderstorm",
    96: "‚õà Hail Storm", 99: "üå© Severe Storm"
  };

  const container = document.getElementById("cities");
  const foodGallery = document.getElementById("food-gallery");

  // --- Currency Logic (Base EUR) ---
  async function updateCurrency() {
    try {
        // Fetch rates with Base EUR
        const res = await fetch("https://api.frankfurter.app/latest?from=EUR&to=USD,TRY");
        const data = await res.json();
        
        // data.rates.USD is how many USD = 1 EUR
        // data.rates.TRY is how many TRY = 1 EUR
        
        document.querySelector("#eur-usd span").textContent = data.rates.USD.toFixed(2);
        document.querySelector("#eur-try span").textContent = data.rates.TRY.toFixed(2);
    } catch (e) {
        console.error("Currency Error", e);
    }
  }

  // --- Image Compression ---
  function resizeImage(file, callback) {
    const reader = new FileReader();
    reader.onload = function(event) {
        const img = new Image();
        img.onload = function() {
            const canvas = document.createElement("canvas");
            const ctx = canvas.getContext("2d");
            const maxWidth = 800; 
            let width = img.width;
            let height = img.height;

            if (width > maxWidth) {
                height = height * (maxWidth / width);
                width = maxWidth;
            }

            canvas.width = width;
            canvas.height = height;
            ctx.drawImage(img, 0, 0, width, height);
            const dataUrl = canvas.toDataURL("image/jpeg", 0.7); 
            callback(dataUrl);
        };
        img.src = event.target.result;
    };
    reader.readAsDataURL(file);
  }

  // --- City UI ---
  cities.forEach(city => {
    const div = document.createElement("div");
    div.className = "city";
    div.innerHTML = `
      <img src="${city.img}" alt="${city.name}"> 
      <div class="city-info">
        <h3>${city.name}</h3>
        <p class="time">--:--</p>
        <p class="temp">-- ¬∞C</p>
        <p class="condition">--</p> 
        <div class="actions">
            <label class="action-btn" title="Upload Photo">
                üì∑ <input type="file" class="file-input" accept="image/*">
        </div>
      </div>
    `;
    container.appendChild(div);
    city.element = div;

    div.querySelector(".file-input").addEventListener("change", (e) => {
        if (e.target.files[0]) {
            resizeImage(e.target.files[0], (dataUrl) => {
                set(ref(db, "cities/" + city.name + "/img"), dataUrl);
            });
        }
    });

    onValue(ref(db, "cities/" + city.name + "/img"), snap => {
      if(snap.val()) div.querySelector("img").src = snap.val();
    });
  });

  // --- Food Section ---
  document.getElementById("food-input").addEventListener("change", (e) => {
    if (e.target.files[0]) {
        resizeImage(e.target.files[0], (dataUrl) => {
            push(ref(db, "foods"), { url: dataUrl, timestamp: Date.now() });
        });
    }
  });

  onValue(ref(db, "foods"), snap => {
    foodGallery.innerHTML = "";
    const data = snap.val();
    
    if (!data) {
        foodGallery.innerHTML = '<p style="grid-column: 1/-1; text-align: center; opacity: 0.7;">No food photos yet. Upload one!</p>';
        return;
    }

    Object.keys(data).forEach(key => {
        const item = data[key];
        const div = document.createElement("div");
        div.className = "food-item";
        div.innerHTML = `
            <img src="${item.url}" loading="lazy">
            <button class="delete-food" title="Delete">üóëÔ∏è</button>
        `;
        div.querySelector(".delete-food").addEventListener("click", () => {
            if(confirm("Delete this food photo?")) remove(ref(db, "foods/" + key));
        });
        foodGallery.insertBefore(div, foodGallery.firstChild);
    });
  });

  // --- Time & Weather ---
  function updateTime() {
    const now = new Date();
    cities.forEach(city => {
      const timeStr = now.toLocaleTimeString("en-GB", { timeZone: city.timezone, hour: "2-digit", minute: "2-digit" });
      city.element.querySelector(".time").textContent = timeStr;
    });
  }

  async function updateWeather() {
    for (const city of cities) {
      try {
        const url = `https://api.open-meteo.com/v1/forecast?latitude=${city.lat}&longitude=${city.lon}&current_weather=true`;
        const res = await fetch(url);
        const data = await res.json();
        const code = data.current_weather.weathercode;
        city.element.querySelector(".temp").textContent = `${data.current_weather.temperature} ¬∞C`;
        city.element.querySelector(".condition").textContent = weatherDescriptions[code] || "Unknown";
      } catch {
        city.element.querySelector(".temp").textContent = "N/A";
      }
    }
  }

  updateTime(); setInterval(updateTime, 1000);
  updateWeather(); setInterval(updateWeather, 10 * 60 * 1000);
  updateCurrency(); setInterval(updateCurrency, 60 * 60 * 1000);

</script>
</body>
</html>
